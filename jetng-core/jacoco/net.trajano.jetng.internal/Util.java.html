<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Util.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Java Emitter Template NG Core</a> &gt; <a href="index.source.html" class="el_package">net.trajano.jetng.internal</a> &gt; <span class="el_source">Util.java</span></div><h1>Util.java</h1><pre class="source lang-java linenums">package net.trajano.jetng.internal;

import java.io.EOFException;
import java.io.IOException;
import java.io.PushbackReader;
import java.util.HashSet;
import java.util.Set;

import net.trajano.jetng.ParserContext;

/**
 * This class contains methods that have been exported so it can be tested
 * without making it part of the public API.
 *
 * @author Archimedes Trajano
 *
 */
public final class Util {
    /**
     * Characters that are safe to put in a Java string without escaping.
     */
    private static final Set&lt;Character&gt; SAFE_CHARACTERS;
    static {
<span class="fc" id="L24">        SAFE_CHARACTERS = new HashSet&lt;Character&gt;();</span>
<span class="fc bfc" id="L25" title="All 2 branches covered.">        for (final char c : &quot; 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~!@#$%^&amp;*()_+{}|:;'/?&lt;&gt;,.[]-=&quot;</span>
<span class="fc" id="L26">                .toCharArray()) {</span>
<span class="fc" id="L27">            SAFE_CHARACTERS.add(c);</span>
        }
<span class="fc" id="L29">    }</span>

    /**
     * Escapes a string to make it work as a Java string. The result will
     * already be quoted. The exception is if &quot;s&quot; is null this will return
     * &quot;null&quot; as a string (without quotes). If the input string is empty this
     * will return an empty string. If it is a single character, then the quoted
     * string returned is single quoted.
     *
     * @param s
     *            string to escape
     * @return quoted escaped string
     */
    public static String escapeJavaString(final String s) {
<span class="fc bfc" id="L43" title="All 2 branches covered.">        if (s == null) {</span>
<span class="fc" id="L44">            return &quot;null&quot;;</span>
<span class="fc bfc" id="L45" title="All 2 branches covered.">        } else if (s.isEmpty()) {</span>
<span class="fc" id="L46">            return &quot;&quot;;</span>
<span class="fc bfc" id="L47" title="All 2 branches covered.">        } else if (&quot;'&quot;.equals(s)) {</span>
<span class="fc" id="L48">            return &quot;'\\''&quot;;</span>
<span class="fc bfc" id="L49" title="All 2 branches covered.">        } else if (&quot;\&quot;&quot;.equals(s)) {</span>
<span class="fc" id="L50">            return &quot;'\&quot;'&quot;;</span>
<span class="fc bfc" id="L51" title="All 2 branches covered.">        } else if (s.length() == 1) {</span>
<span class="fc" id="L52">            return &quot;'&quot; + escapeSingleCharacter(s.charAt(0)) + &quot;'&quot;;</span>
        }
<span class="fc" id="L54">        final char[] carray = s.toCharArray();</span>
<span class="fc" id="L55">        final StringBuilder b = new StringBuilder(&quot;\&quot;&quot;);</span>
<span class="fc bfc" id="L56" title="All 2 branches covered.">        for (final char c : carray) {</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">            if (c == '&quot;') {</span>
<span class="fc" id="L58">                b.append(&quot;\\\&quot;&quot;);</span>
<span class="fc" id="L59">            } else {</span>
<span class="fc" id="L60">                b.append(escapeSingleCharacter(c));</span>
            }
        }
<span class="fc" id="L63">        b.append('&quot;');</span>
<span class="fc" id="L64">        return b.toString();</span>
    }

    /**
     * Escapes a single character.
     *
     * @param c
     *            character to escape
     * @return escaped character
     */
    private static String escapeSingleCharacter(final char c) {
<span class="fc bfc" id="L75" title="All 2 branches covered.">        if (c == '\r') {</span>
<span class="fc" id="L76">            return &quot;\\r&quot;;</span>
<span class="fc bfc" id="L77" title="All 2 branches covered.">        } else if (c == '\n') {</span>
<span class="fc" id="L78">            return &quot;\\n&quot;;</span>
<span class="fc bfc" id="L79" title="All 2 branches covered.">        } else if (c == '\t') {</span>
<span class="fc" id="L80">            return &quot;\\t&quot;;</span>
<span class="fc bfc" id="L81" title="All 2 branches covered.">        } else if (SAFE_CHARACTERS.contains(c)) {</span>
<span class="fc" id="L82">            return String.valueOf(c);</span>
        } else {
<span class="fc" id="L84">            return String.format(&quot;\\u%04x&quot;, (int) c);</span>
        }
    }

    /**
     * If a defined text is coming up, this will return &lt;code&gt;true&lt;/code&gt; and
     * the reader will be at the point after the text. Otherwise, the data will
     * be pushed back up until the character
     *
     * @param context
     *            parsing context
     * @param firstChar
     *            first character
     * @param text
     *            text being expected.
     * @param r
     *            reader
     * @return end comment
     */
    public static boolean isTextComing(final ParserContext context,
            final char firstChar, final String text, final PushbackReader r)
            throws IOException {

<span class="fc" id="L107">        final char[] carray = text.toCharArray();</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">        if (firstChar != carray[0]) {</span>
<span class="fc" id="L109">            return false;</span>
        }
<span class="fc" id="L111">        int i = 1;</span>
<span class="fc bfc" id="L112" title="All 2 branches covered.">        while (i &lt; carray.length) {</span>
<span class="fc" id="L113">            final int c = r.read();</span>
<span class="pc bpc" id="L114" title="1 of 2 branches missed.">            if (c == -1) {</span>
<span class="nc" id="L115">                throw new EOFException();</span>
<span class="fc bfc" id="L116" title="All 2 branches covered.">            } else if (c != carray[i]) {</span>
<span class="fc" id="L117">                r.unread(c);</span>
<span class="fc" id="L118">                r.unread(carray, 1, i - 1);</span>
<span class="fc" id="L119">                return false;</span>
            }
<span class="fc" id="L121">            ++i;</span>
        }
<span class="fc bfc" id="L123" title="All 2 branches covered.">        for (int j = 0; j &lt; carray.length - 1; ++j) {</span>
<span class="fc" id="L124">            context.inc();</span>
        }
<span class="fc" id="L126">        return true;</span>
    }

    /**
     * Prevent instantiation of utility class.
     */
<span class="nc" id="L132">    private Util() {</span>
<span class="nc" id="L133">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>